<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Step Tracking with OpenStreetMap</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <style>
    * {
        border: 0;
        padding: 0;
        margin: 0;
    }
    #map { height: 100vh; width: 100vw; }
    #stats {
      position: absolute;
      top: 10px;
      left: 10px;
      background: white;
      padding: 10px;
      z-index: 1000;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      font-family: Arial, sans-serif;
    }
  </style>
</head>
<body>
  <div id="stats">
    <p>Steps: <span id="steps">0</span></p>
    <p>Distance: <span id="distance">0</span> meters</p>
  </div>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script>
    // Initialize variables
    let map;
    let userPath = [];
    let totalDistance = 0;
    let steps = 0;
    const stepLength = 0.75; // approximate step length in meters

    // Function to calculate distance between two coordinates
    function calculateDistance(lat1, lon1, lat2, lon2) {
      const R = 6371e3; // Earth's radius in meters
      const phi1 = lat1 * Math.PI / 180;
      const phi2 = lat2 * Math.PI / 180;
      const deltaPhi = (lat2 - lat1) * Math.PI / 180;
      const deltaLambda = (lon2 - lon1) * Math.PI / 180;

      const a = Math.sin(deltaPhi / 2) * Math.sin(deltaPhi / 2) +
                Math.cos(phi1) * Math.cos(phi2) *
                Math.sin(deltaLambda / 2) * Math.sin(deltaLambda / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c; // Distance in meters
    }

    // Initialize Map
    function initMap() {
      map = L.map('map').setView([0, 0], 13);

      // Add OpenStreetMap tile layer
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      // Start tracking user position
      if (navigator.geolocation) {
        navigator.geolocation.watchPosition(onLocationFound, onLocationError, { enableHighAccuracy: true });
      } else {
        alert("Geolocation is not supported by this browser.");
      }
    }

    // Handle user's location updates
    function onLocationFound(position) {
      const { latitude, longitude } = position.coords;

      // If this is the first position, just center the map
      if (userPath.length === 0) {
        map.setView([latitude, longitude], 16);
      } else {
        // Calculate distance from last point
        const lastPoint = userPath[userPath.length - 1];
        const distance = calculateDistance(lastPoint.lat, lastPoint.lng, latitude, longitude);
        totalDistance += distance;

        // Estimate steps based on distance
        steps += Math.floor(distance / stepLength);

        // Update stats
        document.getElementById('steps').innerText = steps;
        document.getElementById('distance').innerText = totalDistance.toFixed(2);
      }

      // Update path and add a marker
      userPath.push({ lat: latitude, lng: longitude });
      L.polyline(userPath, { color: 'blue' }).addTo(map);
      L.marker([latitude, longitude]).addTo(map);
    }

    // Handle location errors
    function onLocationError(error) {
      alert(`Error: ${error.message}`);
    }

    // Initialize the map on page load
    document.addEventListener("DOMContentLoaded", initMap);
  </script>
</body>
</html>
